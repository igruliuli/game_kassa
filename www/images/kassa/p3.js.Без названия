/*! p3chat - v0.1.0 - 2016-04-21
* Home: http://p3chat.com
* Copyright (c) 2010-2016 P3chat team*/
var p3chat=p3chat||{};(function(){var n=function(){for(var n=["boolean","string","number","array","object","date","regexp","null","function"],t={},e=0;n.length>e;++e)t["[object "+n[e]+"]"]=n[e];return function(n,e){var o=null==n?n+"":t[Object.prototype.toString.call(n).toLowerCase()];return e?0===o.indexOf(e):o}}(),t=function(t,e){function o(n,t){for(var e,o=function(n){return function(){var t=[].slice.call(arguments);l.push([n].concat(t))}};e=t.shift();)n[e]=o(e);n._cs=a}function r(n){var t,o=n.shift();(t=s.get(o))?t[o].apply(t,n):(e&&n.unshift("["+(new Date).toUTCString()+"]"),l._push([o].concat(n)))}function i(n,t){var e,o=l;for(l=u([]),s.set(n,t);e=o.shift();)r(e)}function u(n){return n._push=n.push,n.push=r,a._q=n}var a={},l=u(t||[]),s=function(){function t(){}function e(n){return r[n]}function o(e,o){var i=function(n,t){return function(){t.apply(n,[].slice.call(arguments))}};for(var u in e)if(e.hasOwnProperty(u))if(r[u]={},"function"===n(e[u]))r[u][u]=e[u];else if("object"===n(e[u])&&"function"===n(e[u][u]))r[u]=e[u];else if("array"===n(e[u]))for(var a,l,s=e[u],c=0;s.length>c;++c){if(a={oname:s[c][0],fname:s[c][1]},l=o&&o[a.oname],l&&"function"===n(l[a.fname])){r[u][u]=i(l,l[a.fname]);break}r[u][u]=t}}var r={};return{get:e,set:o}}();return a.source=o,a.resolve=i,a},e=function(t){var e,o={},r=!1,i=!1,u=[],a=function(t){if(i)return!1;for(i=r=!0,e="array"===n(t)?t:[t];u.length;)u.shift().apply(o,e);return!0},l=function(n){return n&&"function"==typeof n&&u.push(n),r?(i&&u.length&&u.pop().apply(o,e),o):(r=!0,"function"==typeof t&&t(o),o)};return o.fulfill=a,o.then=l,o},o=function(){var t=[].slice.call(arguments),o=t.length,r=0;return e(function(i){for(var u,a=function(){r++,r===o&&i.fulfill([].slice.call(arguments))},l=0;o>l;++l)u=t[l],"function"===n(u.then)?u.then(a):u&&e().then(a).fulfill()})},r=function(n){function t(t,e,r){for(var i,u,a=t.split(" ");i=a.shift();)if(u=o[i]=o[i]||[],u.push(e),r){u.result&&e.apply(n,[i].concat(u.result));for(var l in o)o.hasOwnProperty(l)&&i!==l&&i===l.split(".")[0]&&o[l].result&&e.apply(n,[l].concat(o[l].result))}return n}function e(t,e){function r(r){for(var i=o[r]=o[r]||[],u=0;i.length>u;++u)i[u].apply(n,[t].concat(e));return i}var i=t.split(".")[0];return i!==t&&r(i),r(t).result=e,n}var o={};return n.on=t,n.trigger=e,n},i=function(){function n(){return parseInt(/p3chat.com.dbg=([^;]+)(?:;|$)/.test(document.cookie)?RegExp.$1:0,10)}return{mode:n()}}();p3chat._p3={t:n,Promise:e,when:o,asEventful:r,CallStream:t,dbg:i,skip:!!p3chat._p3}})(window),function(n){function t(){var n,t=[],e=function(){for(var n,t,e="",o=i.getElementsByTagName("script"),u=RegExp(l.LOADER_OLD_URL.replace(/\//g,"")+"(\\d{5,15})","i"),a=function(n){return void 0!==n.getAttribute.length?n.src:n.getAttribute("src",4)},s=[],c=o.length-1;c>=0;){if(t=o[c--],n=a(t),e=u.exec(n.replace(/^https?:/i,"").replace(/\//g,"")),e=e&&e[1])return e;s.push(n)}return r("Failed to find suid among: "+s.join("\n")),null};return(n=e())&&(t.push(["_setAccount",n]),t.push(["_trackPage"])),t}function e(){}var o=n.p3chat._p3;o.CallStream(null,!0).source(o.dbg,["log","dir"]);var r=o.dbg.log,i=n.document,u=n.navigator,a=n.MooTools,l=function(){return{STATIC_URL:"//p3chat.com/dist",SERVICE_URL:"//p3chat.com/widget",LOADER_OLD_URL:"//p3chat.com/widget/uid",BOSH_URL:"//p3chat.com/widget/bosh",EMAIL_URL:"//p3chat.com/widget/offlinemsg",NS:"p3chat-",TS:"20160421080459"}}(),s=function(){var n=/MSIE 6/i.test(u.userAgent),t="BackCompat"===i.compatMode&&/MSIE/i.test(u.userAgent),e=/\.1/.test(a!==void 0&&a.version);return{res:n||t,warn:n&&"IE6"||t&&"IE Quirks Mode"||e&&"MooTools 1.1x"||""}},c=function(t){function e(){i.removeEventListener?(i.removeEventListener("DOMContentLoaded",r,!1),n.removeEventListener("load",r,!1)):(i.attachEvent("onreadystatechange",r),n.detachEvent("onload",r))}var o=!1,r=function(n){o||(i.addEventListener||n&&"load"===n.type||"complete"===i.readyState)&&(o=!0,e(),t())};"complete"===i.readyState?setTimeout(r):i.addEventListener?(i.addEventListener("DOMContentLoaded",r,!1),n.addEventListener("load",r,!1)):i.attachEvent&&(i.attachEvent("onreadystatechange",r),n.attachEvent("onload",r))},f=o.Promise(),d=o.Promise(function(n){var t=s();t.res||c(function(){n.fulfill()}),o.supported=t.res?!1:t.warn?"maybe":!0,t.warn&&r("P3chat unsupported: "+t.warn)});return o.ver="0.1.0",o.consts=l,o.dep_uid=null,o.global=n.p3chat,o.cs=o.CallStream("array"===o.t(o.global)?o.global:t()),o.cs.resolve({_setAccount:function(n){o.dep_uid=n,f.fulfill()}}),o.domReady=function(n){o.when(!o.skip,d,f).then(n)},o.global.ready=e,o.asEventful(o),o}(window),function(n){var t,e,o=n.p3chat._p3,r=o.dbg?o.dbg.log:function(){},i=n.document,u=i.head||i.getElementsByTagName("head")[0],a=i.body||i.getElementsByTagName("body")[0]||u,l=function(n){function l(n,t){var e=i.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=n,u.appendChild(e),t()}function s(n,t,e){var u=e?t:function(n){return function(){r("loaded: "+n);try{t()}catch(e){r("onready fail: "+n),o.dbg.dir(e)}}}(n),l=!1,s=i.createElement("script");s.onload=s.onreadystatechange=function(){l||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(l=!0,u(),s.onload=s.onreadystatechange=null)},s.src=n,a.appendChild(s)}function c(t){if(n.depends[t]===void 0)return n.onComplete(),void 0;var o=n.depends[t],i=f+o.url,u=o.nocache?parseInt(1e7*Math.random(),10):e;if(i+=-1===i.indexOf("?")?"?":"&",i+=u,!o.found()||o.cannot_skip)if(/\.css$/i.test(o.url))l(i,function(){c(t+1)});else{if(!/\.js(\?.*)?$/i.test(o.url))throw"Unknown dependency type: "+i;s(i,function(){if(!o.found()&&!o.can_skip)throw"Failed requirements after load: "+i;"function"==typeof o.onFound&&o.onFound(),c(t+1)},n.depends.dev)}else o.can_skip||r("Warn: dependency already exist for: "+i),c(t+1)}var f=n.base_url||t||"./";return function(){c(0)}};o.Loader=function(n){return e=n.ts,t=n.base_url,{load:function(n){l(n)()}}}}(window),function(n){var t=n.p3chat._p3,e=function(){function t(){return f.getElementsByTagName("body")[0]}function e(n){return f.getElementById(n)}function o(n,t){for(var e=[],o=f.getElementById(n);o;)(t||{}).fixId&&o.removeAttribute("id"),e.push(o),o=f.getElementById(n);return e}function r(n,t){for(var e=null,o=n.childNodes,r=0;o.length>r;++r)if(t.test(o[r].nodeName)){e=o[r];break}return e}function i(){for(var n,t=[].slice.call(arguments),e=t.shift(),o=0;t.length>o;o++){n=t[o];for(var r in n)n.hasOwnProperty(r)&&(e.style[r]=n[r])}}function u(n){var o=null;n.unique&&(o=e(n.attrs.id),o&&o.parentNode.removeChild(o)),o=f.createElement(n.name);var r=n.attrs||{};for(var u in r)r.hasOwnProperty(u)&&(o[u]=r[u]);var a=n.styles||[];return a.unshift(o),i.apply(null,a),(n.parent||t()).appendChild(o),o}function a(n){return f.getElementsByClassName?f.getElementsByClassName(n):l(n)}function l(n){for(var t=[],e=f.getElementsByTagName("*"),o=RegExp("(^|\\s*)"+n+"(\\s*|$)"),r=0,i=e.length;i>r;r++)o.test(e[r].className)&&t.push(e[r]);return t}function s(n,t){n.className=[n.className,t].join(" ")}function c(n,t){return n.getAttribute(t)}var f=n.document;return{body:t,elById:e,elsById:o,elsByClass:a,findChild:r,setStyles:i,createEl:u,appendClass:s,getAttr:c}}();t.Buttons=function(n){function t(){var t=[],o=e.elsById("chat-launcher-c6be047eb0ae",{fixId:!0});s(o,function(n,t){s("p3chat-launcher p3chat-legacy".split(" "),function(n,o){e.appendClass(t,o)})});var r=e.elsByClass("p3chat-launcher");s(r,function(o,r){var i,u,a=e.getAttr(r,"data-tid"),l=null!==a&&d(n.teams,a);l?(u=l.online,i=l.button,u||n.offlineMsg||(a=null)):(a=null,i=n.spec.inline,u=y);var s={el:r,inline:!0,tid:a,online:u,spec:i};t.push(s)});var u=n.spec.floating;return u&&t.push({el:i(u),inline:!1,tid:null,online:y,spec:u}),t}function o(n){return s(n,function(n,t){t.inline&&r(t),b&&(e.setStyles(t.el,v.finger),e.appendClass(t.el,"p3chat-active"),t.el.onmouseover=u(t.el),t.el.onclick=a(t))}),n}function r(n){e.setStyles(n.el,v.inline);var t=e.findChild(n.el,/^img$/i),o=n.spec&&n.spec.url,r=n.online?"online":"offline";t&&o&&(o.offline||(o.offline=t.src),t.src=n.spec.url[r]),e.appendClass(n.el,"p3chat-"+r)}function i(n){var t="p3chat-launcher-float",o=e.createEl({name:"div",attrs:{id:t},unique:!0,styles:[v.floats,c(n.position),n.hidden?v.hidden:{}]}),r=y?"online":"offline",i=n.url&&n.url[r];return e.createEl({name:"img",attrs:{src:i},styles:[v.image],parent:o}),e.appendClass(o,"p3chat-"+r),o}function u(n){return h.push(n),function(){if(g){for(;h.length;)h.shift().onmouseover=null;g.apply(p)}}}function a(n){return function(){m={tid:n.tid}}}function l(n){g=n}function s(n,t){for(var e=0,o=(n||[]).length;o>e&&t.apply(null,[e,n[e]])!==!1;++e);}function c(n){var t={n:"top",e:"right",s:"bottom",w:"left"},e={bottom:"top",top:"bottom",left:"right",right:"left"},o={};for(var r in n)if(n.hasOwnProperty(r)){o[t[r]]=0,o[e[t[r]]]="auto";for(var i in e)e.hasOwnProperty(i)&&n[r][i]&&(o[i]=n[r][i],o[e[i]]="auto")}return o}function f(n){var t=!1;return s(n,function(n,e){return e.online?(t=!0,!1):void 0}),t}function d(n,t){var e=null;return s(n,function(n,o){return o.tid===t?(o.button||(o.button={url:{online:o.onlineBtnUrl,offline:o.offlineBtnUrl}},delete o.onlineBtnUrl,delete o.offlineBtnUrl),e=o,!1):void 0}),e}var p={},h=[],g=null,m=null,v={inline:{display:"inline"},floats:{display:"inline",position:"fixed",zIndex:"99999"},finger:{cursor:"pointer"},hidden:{display:"none"},image:{margin:"0",padding:"0",border:"0 none",display:"block"}},y=f(n.teams),b=y||n.offlineMsg,E=o(t());return p.hover=l,p.clicked=function(){return m},p.anyActive=function(){return b},p.buttons=function(){return E},p}}(window),function(n){var t=n.p3chat._p3,e=function(){function t(){try{return void 0!==n.ActiveXObject}catch(t){return!1}}function e(){var n=r.getElementById(i);if(n)return n;try{n=r.createElement('<div style="display:none;behavior:url(\'#default#userData\')" id="'+i+'"></div>'),r.getElementsByTagName("body")[0].appendChild(n)}catch(t){return null}return n}var o={},r=n.document,i="p3c-ie-store",u=t()?e():null,a="ie-userData",l=function(n){return u.load(i),u.getAttribute(n)},s=function(n,t){return u.setAttribute(n,t),u.save(i),u?t:null},c=function(){u.load(i);var n,t,e=u.XMLDocument,o=[];if(e&&e.documentElement&&e.documentElement.attributes){for(n=e.documentElement,t=0;n.attributes.length>t;++t)o.push(n.attributes.item(t).nodeName);for(t=0;o.length>t;++t)u.removeAttribute(o[t]);u.save(i)}};return o.getItem=l,o.setItem=s,o.clear=c,o.name=a,u?o:null},o=function(){function t(){try{return!!localStorage.getItem}catch(n){return!1}}var o={},r=t()?n.localStorage:e(),i=r&&r.name||"w3c-localStorage",u=function(n){return r.getItem(n)},a=function(n,t){return r.setItem(n,t),t},l=function(){r.clear()};return o.get=u,o.set=a,o.clear=l,o.name=i,r?o:null};t.store=o()}(window),function(n){function t(){r.load({depends:[{url:"/js/debug.js",found:function(){return!!e.dbg.setMode},cannot_skip:!1}],onComplete:function(){e.dbg.setMode(e.dbg.mode),e.log("Dbg Mode enabled: "+e.dbg.mode)}})}var e=n.p3chat._p3,o=e.log=e.dbg.log,r=e.Loader({base_url:e.consts.STATIC_URL,ts:e.consts.TS}),i=function(){var t=!1;return[{url:"/css/p3.css",found:function(){return!1}},{url:"/js/jquery/all-jqplugins.js",found:function(){return!("undefined"!=typeof jQuery&&"1.5.2"===jQuery.fn.jquery&&jQuery.ui&&"1.8.12"===jQuery.ui.version)},onFound:function(){e.jq=jQuery,t=!0},can_skip:!0},{url:"/js/jquery/all-jquery-jqplugins.js",found:function(){return t},onFound:function(){e.jq=jQuery.noConflict(!0)},can_skip:!0},{url:"/js/all-p3.js",found:function(){return!!e.Model}},{url:"/js/json3.js",found:function(){return!!n.JSON},can_skip:!0}]}(),u=e.Promise(),a=e.Promise();e.global.ready=function(n){"function"==typeof n&&(a.then(n),u.fulfill())},e.domReady(function(){function l(){function l(n){return y?(o("Load: "+n+" (skipped)"),void 0):(y=!0,o("Load: "+n),r.load({depends:i,onComplete:function(){e.Model.init(e.dep_uid,b,v),e.global.open=function(n){e.Model.forceChat({api_msg:n||""})},a.fulfill()}}),void 0)}function s(){var n=e.store&&e.store.get("p3chat"),t=n&&n.match(/"user_uid"\s*:\s*"(.*?)"/)[1]||c(10);return t}function c(n){var t,e="",o=[];for(t=48;57>=t;++t)o.push(t);for(t=97;122>=t;++t)o.push(t);for(;n--;)e+=String.fromCharCode(o[Math.floor(Math.random()*(o.length-1))]);return e}if(e.settings.disableChat)return o("p3: disabled"),void 0;var f,d=!1,p=!1;e.store&&(f=e.store.get("p3chat"),d=/"session"\s*:\s*"alive"/.test(f),p=/"opened"\s*:\s*"?true"?/.test(f));var h=!(d||p),g=p&&d,m=e.settings.buttons;m.floating&&(m.floating.hidden=g);var v=e.Buttons({spec:m,teams:e.settings.teams,offlineMsg:e.settings.offlineMsgSupport}),y=!1,b=s();e.dbg.mode&&(i.dev=!0,t());var E=v.anyActive();E?(e.autochat_loaded=e.Promise(function(n){var t=e.settings.autoChatRules;t&&r.load({depends:[{url:"/js/autochat.js",found:function(){return!!e.Autochat},cannot_skip:!0}],onComplete:function(){n.fulfill(e.Autochat({rules:t}))}})}).then(function(n){n.on("match",function(n){l("rule "+n+" matched..")}),e.cs.resolve({_trackPage:n.track})}),e.operator_fired=e.Promise(function(t){var o=e.settings.showPresence;(o=o&&o.base)&&r.load({depends:[{url:"/js/socket.io/socket.io.js",can_skip:!0,found:function(){return n.io},onFound:function(){}}],onComplete:function(){var n={query:"user_uid="+b},e=io.connect(o+"/visitor?",n);e.on("connect",function(){t.fulfill(e)})}})}).then(function(){l("WO link")}),u.then(function(){l("ready() api")}),h?v.hover(function(){l("on hover..")}):l("resuming session..")):o("L: Nothing active")}var s=e.Promise(function(n){if(!e.dep_uid)throw"No uid found";e.settings?n.fulfill():r.load({base_url:e.consts.SERVICE_URL,depends:[{url:"/uid/"+e.dep_uid+"/settings.js",found:function(){return e.global.settings!==void 0},cannot_skip:!1,nocache:!0}],onComplete:function(){e.settings=e.global.settings,delete e.global.settings,n.fulfill()}})});s.then(l)}),e.debug=function(n){return e.dbg.mode!==n&&(e.dbg.mode=n,t()),e.dbg}}(window);